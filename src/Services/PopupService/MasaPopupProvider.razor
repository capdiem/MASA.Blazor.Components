@namespace MASA.Blazor.Experimental.Components
@inject IPopupProvider PopupProvider
@implements IDisposable

@foreach (var item in PopupProvider.GetItems())
{
    <CascadingValue @key="item" Value="item">
        <DynamicComponent Type="item.ComponentType" Parameters="item.Parameters"></DynamicComponent>
    </CascadingValue>
}

@code {

    protected override void OnInitialized()
    {
        PopupProvider.StateChanged += OnStateChanged;
    }

    private void OnStateChanged(object? sender, EventArgs e)
    {
        InvokeAsync(() => StateHasChanged());
    }

    public void Dispose()
    {
        PopupProvider.StateChanged -= OnStateChanged;
    }

}